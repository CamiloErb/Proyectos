{"ast":null,"code":"'use strict';\n\nvar util = require('util');\n\nvar events = require(\"events\");\n\nvar WebSocket = require('ws'),\n    defaultOptions = {\n  url: 'ws://stream.tradingeconomics.com/',\n  key: 'guest',\n  secret: 'guest',\n  reconnect: true,\n  //reconnect on error/disconnect \n  reconnect_timeout: 30000,\n  //time (in miliseconds) to wait before attepmt to reconect\n  onMessage: function () {},\n  onError: function () {}\n};\n\nvar TEClient = function (options) {\n  events.EventEmitter.call(this);\n  this.userOptions = options || {};\n  this.init.apply(this);\n  return this;\n};\n\n_c = TEClient;\nutil.inherits(TEClient, events.EventEmitter);\n\nTEClient.prototype.init = function () {\n  var _this = this;\n\n  _this.options = merge(defaultOptions, _this.userOptions);\n  _this.subArr = []; // [\"calendar\"]\n\n  _this.connect.apply(this);\n\n  return _this;\n};\n\nTEClient.prototype.connect = function () {\n  var _this = this,\n      options = _this.options,\n      url = buildWsUrl(options);\n\n  console.log('\\n Connecting to ', url);\n  _this.ws = new WebSocket(url);\n\n  _this.ws.on('open', function () {\n    console.log('SOCKET CONNECTED'); //subscribe to our list\n\n    _this.subArr.forEach(function (subject) {\n      _this.ws.send('{\"topic\": \"subscribe\", \"to\": \"' + subject + '\"}');\n    });\n  });\n\n  _this.ws.on('message', function (data) {\n    try {\n      var aux = JSON.parse(data);\n\n      if (aux.topic && aux.topic != 'keepalive') {\n        _this.emit('message', aux);\n      }\n    } catch (err) {//console.log(err);\n    }\n  });\n\n  _this.ws.on('close', function () {\n    console.log('SOCKET CLOSED');\n\n    if (options.reconnect) {\n      console.log('Trying to reconnect in ', options.reconnect_timeout);\n      setTimeout(function () {\n        _this.connect();\n      }, options.reconnect_timeout);\n    }\n  });\n\n  _this.ws.on('error', function () {\n    console.log('ERROR');\n\n    if (options.reconnect) {\n      console.log('Trying to reconnect in ', options.reconnect_timeout);\n      setTimeout(function () {\n        _this.connect();\n      }, options.reconnect_timeout);\n    }\n  });\n\n  return _this;\n};\n\nTEClient.prototype.subscribe = function (to) {\n  var _this = this;\n\n  if (_this.subArr.indexOf(to) < 0) {\n    _this.subArr.push(to);\n  }\n\n  if (!_this.ws || _this.ws.readyState != WebSocket.OPEN) {\n    // #todo -> emit error\n    return _this;\n  }\n\n  _this.ws.send('{\"topic\": \"subscribe\", \"to\": \"' + to + '\"}');\n\n  return _this;\n};\n\nmodule.exports = TEClient;\n\nfunction buildWsUrl(options) {\n  var url = options.url;\n  url += '?client=' + options.key + ':' + options.secret;\n  return url;\n}\n/**\r\n * Deep merge two or more objects and return a third object. If the first argument is\r\n * true, the contents of the second object is copied into the first object.\r\n * First, it deep merged arrays, which lead to workarounds in Highcharts. Second,\r\n * it copied properties from extended prototypes. \r\n */\n\n\nfunction merge() {\n  var i,\n      args = arguments,\n      len,\n      ret = {},\n      doCopy = function (copy, original) {\n    var value, key; // An object is replacing a primitive\n\n    if (typeof copy !== 'object') {\n      copy = {};\n    }\n\n    for (key in original) {\n      if (original.hasOwnProperty(key)) {\n        value = original[key]; // Copy the contents of objects, but not arrays or DOM nodes\n\n        if (value && typeof value === 'object' && Object.prototype.toString.call(value) !== '[object Array]' && key !== 'renderTo' && typeof value.nodeType !== 'number') {\n          copy[key] = doCopy(copy[key] || {}, value); // Primitives and arrays are copied over directly\n        } else {\n          copy[key] = original[key];\n        }\n      }\n    }\n\n    return copy;\n  }; // If first argument is true, copy into the existing object. Used in setOptions.\n\n\n  if (args[0] === true) {\n    ret = args[1];\n    args = Array.prototype.slice.call(args, 2);\n  } // For each argument, extend the return\n\n\n  len = args.length;\n\n  for (i = 0; i < len; i++) {\n    ret = doCopy(ret, args[i]);\n  }\n\n  return ret;\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"TEClient\");","map":{"version":3,"sources":["C:/Users/Camo/Desktop/ORTEX/ortex-app/src/components/EURUDSrate/te_client.js"],"names":["util","require","events","WebSocket","defaultOptions","url","key","secret","reconnect","reconnect_timeout","onMessage","onError","TEClient","options","EventEmitter","call","userOptions","init","apply","inherits","prototype","_this","merge","subArr","connect","buildWsUrl","console","log","ws","on","forEach","subject","send","data","aux","JSON","parse","topic","emit","err","setTimeout","subscribe","to","indexOf","push","readyState","OPEN","module","exports","i","args","arguments","len","ret","doCopy","copy","original","value","hasOwnProperty","Object","toString","nodeType","Array","slice","length"],"mappings":"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","sourcesContent":["\r\n'use strict'\r\n\r\nvar util = require('util');\r\nvar events = require(\"events\");\r\n\r\nvar WebSocket = require('ws'),\r\n\tdefaultOptions = {\r\n\t\turl: 'ws://stream.tradingeconomics.com/', \r\n\t\t\r\n\t\tkey: 'guest',\r\n\t\tsecret: 'guest',\r\n\t\treconnect: true, //reconnect on error/disconnect \r\n\t\treconnect_timeout: 30000, //time (in miliseconds) to wait before attepmt to reconect\r\n\t\tonMessage: function(){},\r\n\t\tonError: function(){}\r\n\t};\r\n\r\n\r\n\r\n\r\nvar TEClient = function(options){\r\n\tevents.EventEmitter.call(this);\r\n\r\n\tthis.userOptions = options || {};\r\n\tthis.init.apply(this);\r\n\r\n\treturn this;\r\n};\r\n\r\nutil.inherits(TEClient, events.EventEmitter);\r\n\r\n\r\nTEClient.prototype.init = function(){\r\n\tvar _this = this;\r\n\r\n\t_this.options = merge(defaultOptions, _this.userOptions);\r\n\t_this.subArr = []; // [\"calendar\"]\r\n\r\n\t_this.connect.apply(this);\r\n\r\n\treturn _this;\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\nTEClient.prototype.connect = function(){\r\n\tvar _this = this,\r\n\t\toptions = _this.options,\r\n\t\turl = buildWsUrl(options);\r\n\r\n\tconsole.log('\\n Connecting to ', url);\r\n\t_this.ws = new WebSocket(url);\r\n\r\n\t\t_this.ws.on('open', function(){\r\n\t\t\tconsole.log('SOCKET CONNECTED');\r\n\t\t\t//subscribe to our list\r\n\t\t\t_this.subArr.forEach(function(subject){\r\n\t\t\t\t_this.ws.send('{\"topic\": \"subscribe\", \"to\": \"'+subject+'\"}');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\r\n\t\t_this.ws.on('message', function(data){\r\n\t\t\ttry{\r\n\t\t\t\tvar aux = JSON.parse(data);\r\n\r\n\t\t\t\tif(aux.topic && aux.topic!='keepalive'){\r\n\t\t\t\t\t_this.emit('message', aux);\r\n\t\t\t\t}\r\n\t\t\t}catch(err){\r\n\t\t\t\t//console.log(err);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t});\r\n\r\n\r\n\t\t_this.ws.on('close', function(){\r\n\t\t\tconsole.log('SOCKET CLOSED');\r\n\t\t\tif(options.reconnect){\r\n\t\t\t\tconsole.log('Trying to reconnect in ', options.reconnect_timeout);\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t_this.connect();\r\n\t\t\t\t}, options.reconnect_timeout);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\r\n\t\t_this.ws.on('error', function(){\r\n\t\t\tconsole.log('ERROR');\r\n\t\t\tif(options.reconnect){\r\n\t\t\t\tconsole.log('Trying to reconnect in ', options.reconnect_timeout);\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t_this.connect();\r\n\t\t\t\t}, options.reconnect_timeout);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\treturn _this;\r\n};\r\n\r\n\r\nTEClient.prototype.subscribe = function(to){\r\n\tvar _this = this;\r\n\r\n\tif(_this.subArr.indexOf(to)<0){\r\n\t\t_this.subArr.push(to);\r\n\t}\r\n\r\n\tif(!_this.ws || _this.ws.readyState != WebSocket.OPEN){ \r\n\t\t// #todo -> emit error\r\n\t\treturn _this;\r\n\t}\r\n\r\n\r\n\t\r\n\t_this.ws.send('{\"topic\": \"subscribe\", \"to\": \"'+to+'\"}');\r\n\r\n\r\n\treturn _this;\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nmodule.exports = TEClient;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction buildWsUrl(options){\r\n\tvar url = options.url;\r\n\r\n\turl += ('?client=' + options.key + ':' + options.secret);\r\n\r\n\treturn url;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Deep merge two or more objects and return a third object. If the first argument is\r\n * true, the contents of the second object is copied into the first object.\r\n * First, it deep merged arrays, which lead to workarounds in Highcharts. Second,\r\n * it copied properties from extended prototypes. \r\n */\r\nfunction merge() {\r\n\tvar i,\r\n\t\targs = arguments,\r\n\t\tlen,\r\n\t\tret = {},\r\n\t\tdoCopy = function (copy, original) {\r\n\t\t\tvar value, key;\r\n\r\n\t\t\t// An object is replacing a primitive\r\n\t\t\tif (typeof copy !== 'object') {\r\n\t\t\t\tcopy = {};\r\n\t\t\t}\r\n\r\n\t\t\tfor (key in original) {\r\n\t\t\t\tif (original.hasOwnProperty(key)) {\r\n\t\t\t\t\tvalue = original[key];\r\n\r\n\t\t\t\t\t// Copy the contents of objects, but not arrays or DOM nodes\r\n\t\t\t\t\tif (value && typeof value === 'object' && Object.prototype.toString.call(value) !== '[object Array]' &&\r\n\t\t\t\t\t\t\tkey !== 'renderTo' && typeof value.nodeType !== 'number') {\r\n\t\t\t\t\t\tcopy[key] = doCopy(copy[key] || {}, value);\r\n\t\t\t\t\r\n\t\t\t\t\t// Primitives and arrays are copied over directly\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcopy[key] = original[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn copy;\r\n\t\t};\r\n\r\n\t// If first argument is true, copy into the existing object. Used in setOptions.\r\n\tif (args[0] === true) {\r\n\t\tret = args[1];\r\n\t\targs = Array.prototype.slice.call(args, 2);\r\n\t}\r\n\r\n\t// For each argument, extend the return\r\n\tlen = args.length;\r\n\tfor (i = 0; i < len; i++) {\r\n\t\tret = doCopy(ret, args[i]);\r\n\t}\r\n\r\n\treturn ret;\r\n}"]},"metadata":{},"sourceType":"module"}